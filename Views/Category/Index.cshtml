@*@model DOANLTWT3BANDIENTHOAIDIDONG.Models.ViewModels.ProductCategoryVM

    @{
        ViewBag.Title = "Danh mục sản phẩm";
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

    <style>

        .filter-sidebar {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .filter-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #d0021b;
        }

        .cate-item {
            margin-bottom: 8px;
            display: block;
            cursor: pointer;
        }

            .cate-item input {
                margin-right: 10px;
                transform: scale(1.2);
            }


        .product-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #fff;
            transition: 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

            .product-card:hover {
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

        .product-img-container {
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

            .product-img-container img {
                max-height: 100%;
                max-width: 100%;
            }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 44px;
        }

        .product-price {
            color: #d0021b;
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .product-link {
            text-decoration: none;
            color: inherit;
        }

        /* CSS Cho Buttons */
        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .btn-buy {
            background: #d0021b;
            color: white;
            flex: 1;
            font-size: 13px;
            font-weight: bold;
            padding: 8px 0;
            border-radius: 4px;
            text-align: center;
        }

            .btn-buy:hover {
                background: #a80014;
                color: white;
            }

        .btn-add-cart {
            background: #eef1f3;
            color: #333;
            flex: 1;
            font-size: 13px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            padding: 8px 0;
        }

            .btn-add-cart:hover {
                background: #dce0e3;
            }
    </style>

    <div class="container" style="margin-top: 30px;">
        <div class="row">
            <div class="col-md-3">
                <div class="filter-sidebar">
                    <h4 class="filter-title">DANH MỤC SẢN PHẨM</h4>
                    <div class="checkbox-list">
                        @foreach (var cat in Model.Categories)
                        {
                            <label class="cate-item">
                                <input type="checkbox" class="category-checkbox" value="@cat.CategoryID" />
                                @cat.CategoryName
                            </label>
                        }
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <div id="loading" style="display:none; text-align:center; padding: 20px;">
                    <img src="https://i.gifer.com/ZZ5H.gif" width="50" /> Đang tải...
                </div>

                <div id="product-list-container">
                    @Html.Partial("_ProductListPartial", Model.Products)
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                // Bắt sự kiện khi click vào checkbox
                $('.category-checkbox').change(function () {
                    var selectedIds = [];

                    // Lấy tất cả ID của checkbox đang được chọn
                    $('.category-checkbox:checked').each(function () {
                        selectedIds.push($(this).val());
                    });

                    // Hiệu ứng loading
                    $('#product-list-container').css('opacity', '0.5');
                    $('#loading').show();

                    // Gửi AJAX về Controller
                    $.ajax({
                        url: '@Url.Action("FilterProducts", "Category")',
                        type: 'POST',
                        data: { categoryIds: selectedIds },
                        traditional: true, // Quan trọng để gửi mảng
                        success: function (res) {
                            $('#product-list-container').html(res);
                            $('#product-list-container').css('opacity', '1');
                            $('#loading').hide();
                        },
                        error: function () {
                            alert("Lỗi tải dữ liệu!");
                            $('#loading').hide();
                        }
                    });
                });
            });

            // Hàm xử lý thêm vào giỏ hàng (Bạn cần CartController cho cái này)
            function addToCart(productId) {
                // Gọi Ajax đến CartController/AddToCart
                 $.ajax({
                    url: '/Cart/AddToCart', // Thay đổi đường dẫn cho đúng với Controller của bạn
                    type: 'POST', // Hoặc GET tùy code của bạn
                    data: { id: productId, quantity: 1 },
                    success: function (res) {
                        alert("Đã thêm sản phẩm vào giỏ hàng!");
                        // Cập nhật số lượng trên icon giỏ hàng nếu cần
                    }
                });
            }
        </script>
    }*@
@model DOANLTWT3BANDIENTHOAIDIDONG.Models.ViewModels.ProductCategoryVM

@{
    ViewBag.Title = "Danh mục sản phẩm";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    /* Reset lệch layout */
    .col-md-9 {
        margin-left: 0 !important;
    }

    .filter-sidebar {
        background: #fff;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #eee;
    }

    .filter-title {
        font-weight: bold;
        margin-bottom: 15px;
        color: #d0021b;
    }

    .cate-item {
        margin-bottom: 8px;
        display: block;
        cursor: pointer;
    }

        .cate-item input {
            margin-right: 10px;
            transform: scale(1.2);
        }


    .product-card {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        background: #fff;
        transition: 0.3s;
        height: 100%;
    }

        .product-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }


    .product-img-container {
        height: 180px;
        margin-bottom: 10px;
        display: block;
        text-align: left; 
    }

        .product-img-container img {
            max-height: 100%;
            max-width: 100%;
            display: block;
            margin: 0;
        }


    .product-name {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
        overflow: hidden;
        height: 44px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .product-price {
        color: #d0021b;
        font-weight: bold;
        font-size: 18px;
        margin-bottom: 15px;
    }

    .product-link {
        text-decoration: none;
        color: inherit;
    }

    
    .product-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }

    .btn-buy {
        background: #d0021b;
        color: white;
        flex: 1;
        font-size: 13px;
        font-weight: bold;
        padding: 8px 0;
        border-radius: 4px;
        text-align: center;
    }

        .btn-buy:hover {
            background: #a80014;
        }

    .btn-add-cart {
        background: #eef1f3;
        color: #333;
        flex: 1;
        font-size: 13px;
        font-weight: bold;
        border: none;
        border-radius: 4px;
        padding: 8px 0;
    }

        .btn-add-cart:hover {
            background: #dce0e3;
        }
</style>

<div class="container" style="margin-top: 30px;">
    <div class="row">
        <div class="col-md-3">
            <div class="filter-sidebar">
                <h4 class="filter-title">DANH MỤC SẢN PHẨM</h4>
                <div class="checkbox-list">
                    @foreach (var cat in Model.Categories)
                    {
                        <label class="cate-item">
                            <input type="checkbox" class="category-checkbox" value="@cat.CategoryID" />
                            @cat.CategoryName
                        </label>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-9">
            <div id="loading" style="display:none; text-align:center; padding: 20px;">
                <img src="https://i.gifer.com/ZZ5H.gif" width="50" /> Đang tải...
            </div>

            <div id="product-list-container">
                @Html.Partial("_ProductListPartial", Model.Products)
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>

        $(document).ready(function () {

            $('.category-checkbox').change(function () {
                var selectedIds = [];

                $('.category-checkbox:checked').each(function () {
                    selectedIds.push($(this).val());
                });

                $('#product-list-container').css('opacity', '0.5');
                $('#loading').show();

                $.ajax({
                    url: '@Url.Action("FilterProducts", "Category")',
                    type: 'POST',
                    data: { categoryIds: selectedIds },
                    traditional: true,
                    success: function (res) {
                        $('#product-list-container').html(res);
                        $('#product-list-container').css('opacity', '1');
                        $('#loading').hide();
                    },
                    error: function () {
                        alert("Lỗi tải dữ liệu!");
                        $('#loading').hide();
                    }
                });
            });
        });

        function addToCart(productId) {
            $.ajax({
                url: '/Cart/AddToCart',
                type: 'POST',
                data: { id: productId, quantity: 1 },
                success: function () {
                    alert("Đã thêm sản phẩm vào giỏ hàng!");
                }
            });
        }

    </script>
}
